'use strict';

/**
 * Function taking a HDI call function and wrapping it for async chaining with failure on rc !== 0.
 *
 * @param {Function} fn Function to wrap
 * @returns {Function} Async function
 */
module.exports = function(fn){
  return function(callback){
    fn((error, result) => {
      if (error){
        return callback(error);
      } else if (result.rc && result.rc < 0) {
        const e = new Error('HDI call failed, check the result for further details.');
        e.result = result;
        return callback(e, result);
      } else {
        return callback(null, result);
      }
    });
  };
};