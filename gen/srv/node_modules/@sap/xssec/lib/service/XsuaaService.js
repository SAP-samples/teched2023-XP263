'use strict';

const requests = require('../requests');

class XsuaaService {
    #jku;
    #zid;           // optional zone id
    #correlationId; // optional

    get jku() { return this.#jku; }
    get zid() { return this.#zid; }
    get correlationId() { return this.#correlationId; }

    constructor(jku, zid, correlationId) {
        if(jku === undefined) {
            throw new Error("XsuaaService requires a jku to fetch JWKS from.");
        }

        this.#jku = jku;
        this.#zid = zid;
        this.#correlationId = correlationId;
    }

    async fetchJwks() {
        return new Promise((res, rej) => {
            try {
                requests.fetchKeyFromXSUAA(this.jku, this.zid, { correlationId: this.correlationId }, function (err, json) {
                    if (err) {
                        rej(e);
                    }

                    res(json.keys);
                });
            } catch (e) {
                rej(e);
            }
        });
    }

    toJSON() {
        return {
            ...this,
            jku: this.jku,
            zid: this.zid
        }
    }
}

module.exports = XsuaaService;