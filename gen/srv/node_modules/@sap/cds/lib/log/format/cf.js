const cds = require ('../../')
const kibana = require('./kibana')

/*
 * extension of log formatter for kibana that additionally logs Cloud Foundry specific data
 */
module.exports = (module, level, ...args) => {
  const toLog = kibana.addFields(module, level, ...args)

  toLog.layer = 'cds'

  // cds.context._ instead of cds.context.http because of messaging
  toLog.tenant_subdomain = cds.context?._?.req?.authInfo?.getSubdomain()

  return kibana.format(toLog)
}