/* eslint-disable cds/no-missing-dependencies */
module.exports = function passport_digest_auth (options) {
  // const session = require('express-session')({ secret:'secret', resave:false, saveUninitialized:true, })
  const { users } = require ('./mocked-users') (options)
  const { DigestStrategy } = require('passport-http')
  const passport = require('passport') .use (new DigestStrategy ((id, done) => {
    // REVISIT: this is never called -> no clue why
    console.trace (id)
    const u = users[id]
    if (!u) return done (null, false)
    else return done (null, u, u.password)
  }))
  return passport.authenticate('digest', {session:false})
}
