/* eslint-disable cds/no-missing-dependencies */
module.exports = function passport_basic_auth (options) {
  // const session = require('express-session')({ secret:'secret', resave:false, saveUninitialized:true, })
  const { BasicStrategy } = require('passport-http')
  const users = require ('./mocked-users') (options)
  const passport = require('passport') .use (new BasicStrategy ((id, pwd, done) => {
    let user = users.verify (id,pwd)
    if (user.failed) return done (null, false, { message: user.failed })
    else return done (null, user)
  }))
  return passport.authenticate('basic', {session:false})
}
