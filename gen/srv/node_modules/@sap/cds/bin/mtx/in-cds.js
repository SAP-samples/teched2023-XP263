const cds = require('../build/cds')

if (cds.requires.multitenancy && cds.utils._oldMtx()) try {
  // eslint-disable-next-line cds/no-missing-dependencies
  const mtx = module.exports = require ('@sap/cds-mtx')()
  mtx.inject (cds)
  cds.on('served', () => cds.emit('mtx'))
} catch(e) {
  if (e.code === 'MODULE_NOT_FOUND') throw new Error('Error serving MTX APIs: @sap/cds-mtx is not installed')
  else throw e
}
else module.exports = undefined

/*
 cds.requires.multitenancy  --  use this to check whether mt is enabled (old or new)
 cds.mtx                    --  use this to check whether old(!) mtx is enabled
*/
