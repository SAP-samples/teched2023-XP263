const cds = require('../../cds')

exports.impl = cds.service.impl(function () {
  const entities = Object.values(this.entities).filter(entity => entity._isDraftEnabled)
  if (entities.length === 0) return

  for (const each of entities) {
    _before(this, each)
    _new(this, each)
    _patch(this, each)
    _cancel(this, each)
    _edit(this, each)
    _prepare(this, each)
    _activate(this, each)
    _delete(this, each)
  }

  _readOverDraft(this) // registers an on READ * handler
  for (const each of entities) _read(this, each) // have to go last
})

const _before = require('../../fiori/generic/before')
const _new = require('../../fiori/generic/new')
const _patch = require('../../fiori/generic/patch')
const _cancel = require('../../fiori/generic/cancel')
const _edit = require('../../fiori/generic/edit')
const _prepare = require('../../fiori/generic/prepare')
const _activate = require('../../fiori/generic/activate')
const _readOverDraft = require('../../fiori/generic/readOverDraft')
const _read = require('../../fiori/generic/read')
const _delete = require('../../fiori/generic/delete')
