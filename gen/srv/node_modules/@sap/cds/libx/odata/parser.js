"use strict";function peg$subclass(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}function peg$SyntaxError(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(r,t){t=void 0!==t?t:{};var e,n={},s={ODataRelativeURI:gn},u=gn,o="/",a=fn("/",!1),c=fn("?",!1),i=fn("&",!1),f="$count",l=fn("$count",!1),h="$ref",p=fn("$ref",!1),A="$value",d=fn("$value",!1),v=function(r){return[r]},g="=",m=fn("=",!1),b="$skiptoken=",y=fn("$skiptoken=",!1),C="$select=",w=fn("$select=",!1),$="$expand=",x=fn("$expand=",!1),E="$filter=",L=fn("$filter=",!1),B="$orderby=",S=fn("$orderby=",!1),T=function(r,t){qs(t)},j="$top=",k=fn("$top=",!1),O="$skip=",Z=fn("$skip=",!1),z="$search=",_=fn("$search=",!1),F="$count=",R=fn("$count=",!1),q="$apply=",I=fn("$apply=",!1),N="$at",D=fn("$at",!1),U="$from",M=fn("$from",!1),P="$toInclusive",G=fn("$toInclusive",!1),H="$to",J=fn("$to",!1),K=fn("*",!1),Q="/$count",V=fn("/$count",!1),W=fn(";",!1),X=function(r){return r?[r]:[]},Y=function(r,t){r.push({xpr:t})},rr=function(r,t){r.push({val:t})},tr=function(r,t,e){r.push(t,...e)},er=function(r,t){r.push(t)},nr=function(r,t,e){r.push(t,...e)},sr=":",ur=fn(":",!1),or="any",ar=fn("any",!1),cr="all",ir=fn("all",!1),fr=fn("asc",!1),lr="desc",hr=fn("desc",!1),pr=function(r,t){return t},Ar="[",dr=fn("[",!1),vr="]",gr=fn("]",!1),mr=/^[a-zA-Z0-9\-_.~]/,br=ln([["a","z"],["A","Z"],["0","9"],"-","_",".","~"],!1,!1),yr=/^[^&]/,Cr=ln(["&"],!0,!1),wr=hn("an aliased parameter (@param)"),$r=fn("@",!1),xr="$format=",Er=fn("$format=",!1),Lr=fn("eq",!1),Br=fn("ne",!1),Sr=fn("lt",!1),Tr=fn("gt",!1),jr=fn("le",!1),kr=fn("ge",!1),Or=fn("in",!1),Zr=(fn("add",!1),fn("sub",!1),fn("mul",!1),fn("div",!1),fn("mod",!1),hn("navigation with $count")),zr=function(r,t){return t},_r=function(r,t){return t?{id:r,where:t}:r},Fr=hn("a reference"),Rr=function(r,t){return t},qr=function(r){return{val:r}},Ir=hn("null"),Nr="null",Dr=fn("null",!1),Ur=hn("a json object"),Mr=fn("{",!1),Pr=/^[^}]/,Gr=ln(["}"],!0,!1),Hr=fn("}",!1),Jr=hn("a json array"),Kr=/^[^\]]/,Qr=ln(["]"],!0,!1),Vr=hn("a list"),Wr=fn(",",!1),Xr=function(r,t){return t},Yr=hn("a function name"),rt=/^[a-zA-Z]/,tt=ln([["a","z"],["A","Z"]],!1,!1),et=function(r,t){return t},nt=function(r,t){return[r,...t]},st="contains",ut=fn("contains",!0),ot="endswith",at=fn("endswith",!0),ct="startswith",it=fn("startswith",!0),ft=fn("NOT",!0),lt=fn("AND",!0),ht=fn("OR",!0),pt="aggregate",At=fn("aggregate",!1),dt="groupby",vt=fn("groupby",!1),gt="filter",mt=fn("filter",!1),bt="search",yt=fn("search",!1),Ct="concat",wt=fn("concat",!1),$t="compute",xt=fn("compute",!1),Et=fn("top",!1),Lt="skip",Bt=fn("skip",!1),St="orderby",Tt=fn("orderby",!1),jt=fn("topcount",!0),kt=fn("bottomcount",!0),Ot=fn("topsum",!0),Zt=fn("bottomsum",!0),zt=fn("toppercent",!0),_t=fn("bottompercent",!0),Ft=function(r,t){return t},Rt="with",qt=fn("with",!1),It="from",Nt=fn("from",!1),Dt=fn("as",!1),Ut="rollup",Mt=fn("rollup",!1),Pt="$all",Gt=fn("$all",!1),Ht=function(r,t){return t},Jt="identity",Kt=fn("identity",!1),Qt=function(r,t){return t},Vt=hn("a boolean"),Wt="true",Xt=fn("true",!1),Yt="false",re=fn("false",!1),te=hn("a single quoted string"),ee="'",ne=fn("'",!1),se="''",ue=fn("''",!1),oe=/^[^']/,ae=ln(["'"],!0,!1),ce=hn("a doubled quoted string"),ie='"',fe=fn('"',!1),le='\\"',he=fn('\\"',!1),pe=/^[^"]/,Ae=ln(['"'],!0,!1),de=hn("a string"),ve=/^[^ \t\n()"&;]/,ge=ln([" ","\t","\n","(",")",'"',"&",";"],!0,!1),me=hn("a date"),be=/^[0-9]/,ye=ln([["0","9"]],!1,!1),Ce="-",we=fn("-",!1),$e=fn("T",!1),xe=fn(".",!1),Ee=fn("Z",!1),Le=fn("+",!1),Be=hn("a number"),Se=/^[+\-]/,Te=ln(["+","-"],!1,!1),je=fn("e",!1),ke=hn("an integer"),Oe=hn("an identifier"),Ze=/^[_a-zA-Z]/,ze=ln(["_",["a","z"],["A","Z"]],!1,!1),_e=/^[_a-zA-Z0-9"."]/,Fe=ln(["_",["a","z"],["A","Z"],["0","9"],'"',".",'"'],!1,!1),Re=hn("a guid"),qe=hn("a hex value"),Ie=/^[0-9a-fA-F]/,Ne=ln([["0","9"],["a","f"],["A","F"]],!1,!1),De=/^[^\/?]/,Ue=ln(["/","?"],!0,!1),Me=/^[a-zA-Z0-9\-"."_~!$'()*+,;=:@"\/""?"]/,Pe=ln([["a","z"],["A","Z"],["0","9"],"-",'"',".",'"',"_","~","!","$","'","(",")","*","+",",",";","=",":","@",'"',"/",'"','"',"?",'"'],!1,!1),Ge=hn("a binary"),He="binary'",Je=fn("binary'",!1),Ke=/^[a-zA-Z0-9\-_]/,Qe=ln([["a","z"],["A","Z"],["0","9"],"-","_"],!1,!1),Ve="==",We=fn("==",!1),Xe=fn("(",!1),Ye=fn(")",!1),rn=hn("an optional whitespace"),tn=/^[ \t\n]/,en=ln([" ","\t","\n"],!1,!1),nn=hn("a whitespace"),sn=0,un=[{line:1,column:1}],on=0,an=[],cn=0;if("startRule"in t){if(!(t.startRule in s))throw new Error("Can't start parsing from rule \""+t.startRule+'".');u=s[t.startRule]}function fn(r,t){return{type:"literal",text:r,ignoreCase:t}}function ln(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function hn(r){return{type:"other",description:r}}function pn(t){var e,n=un[t];if(n)return n;for(e=t-1;!un[e];)e--;for(n={line:(n=un[e]).line,column:n.column};e<t;)10===r.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return un[t]=n,n}function An(r,t){var e=pn(r),n=pn(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:n.line,column:n.column}}}function dn(r){sn<on||(sn>on&&(on=sn,an=[]),an.push(r))}function vn(r,t,e){return new peg$SyntaxError(peg$SyntaxError.buildMessage(r,t),r,t,e)}function gn(){var t,e,s,u,f,l,h,p,A,d,v,g,m,b,y;if(t=sn,47===r.charCodeAt(sn)?(e=o,sn++):(e=n,0===cn&&dn(a)),e===n&&(e=null),e!==n)if(s=sn,(u=mn())!==n&&(s,u=void($s=u)),(s=u)!==n){if(u=sn,(f=gs())!==n)if(63===r.charCodeAt(sn)?(l="?",sn++):(l=n,0===cn&&dn(c)),l!==n)if((h=gs())!==n){if(p=sn,(A=yn())!==n){for(d=[],v=sn,(g=gs())!==n?(38===r.charCodeAt(sn)?(m="&",sn++):(m=n,0===cn&&dn(i)),m!==n&&(b=gs())!==n&&(y=yn())!==n?v=g=[g,m,b,y]:(sn=v,v=n)):(sn=v,v=n);v!==n;)d.push(v),v=sn,(g=gs())!==n?(38===r.charCodeAt(sn)?(m="&",sn++):(m=n,0===cn&&dn(i)),m!==n&&(b=gs())!==n&&(y=yn())!==n?v=g=[g,m,b,y]:(sn=v,v=n)):(sn=v,v=n);d!==n?p=A=[A,d]:(sn=p,p=n)}else sn=p,p=n;p===n&&(p=null),p!==n?u=f=[f,l,h,p]:(sn=u,u=n)}else sn=u,u=n;else sn=u,u=n;else sn=u,u=n;u===n&&(u=null),u!==n&&(f=gs())!==n?(t,t=e=function(){if(xs)return $s.columns=[{args:[{val:1}],as:"$count",func:"count"}],delete $s.expand,delete $s.limit,delete $s.orderBy,$s.apply?Zs($s,$s.apply):{SELECT:$s};let r;if($s.expand){$s.columns||($s.columns=["*"],r=!0);for(const r of $s.expand){const t=$s.columns.findIndex(Ts(r));t>-1&&$s.columns.splice(t,1),$s.columns.push(r)}delete $s.expand}return $s.count&&$s.apply&&($s.__countAggregated=!0),$s.apply?Zs($s,$s.apply,r):{SELECT:$s}}()):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return t}function mn(){var t,e,s,u,c,i,g,m;return t=sn,r.substr(sn,6)===f?(e=f,sn+=6):(e=n,0===cn&&dn(l)),e!==n&&(t,e=void(xs=!0)),(t=e)===n&&(t=sn,e=sn,r.substr(sn,4)===h?(s=h,sn+=4):(s=n,0===cn&&dn(p)),s===n&&(r.substr(sn,6)===A?(s=A,sn+=6):(s=n,0===cn&&dn(d))),(e=s!==n?r.substring(e,sn):s)!==n&&(t,m=e,e=!Es.includes(m)&&{from:{ref:[m]}}),(t=e)===n&&(t=sn,e=sn,(s=fs())!==n?(u=sn,(c=ds())!==n&&(i=vs())!==n?u=c=[c,i]:(sn=u,u=n),u===n&&(u=sn,(c=ds())!==n&&(i=bn())!==n&&(g=vs())!==n?u=c=[c,i,g]:(sn=u,u=n)),u===n&&(u=null),u!==n?(c=sn,cn++,i=ps(),cn--,i===n?c=void 0:(sn=c,c=n),c!==n?e=s=[s,u,c]:(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n),e===n&&(e=sn,(s=ps())!==n&&(e,s=v(s)),e=s),e===n&&(e=null),e!==n?(s=sn,u=sn,47===r.charCodeAt(sn)?(c=o,sn++):(c=n,0===cn&&dn(a)),c!==n&&(u,c=c),(u=c)!==n?((c=mn())===n&&(c=null),c!==n?s=u=[u,c]:(sn=s,s=n)):(sn=s,s=n),s===n&&(s=null),s!==n?(t,t=e=function(r,t){if(t=t&&t[1],!r&&!t)return{from:{ref:[""]}};if(!r&&t&&t.from)return t.from.ref.unshift(""),t;const[e,n]=r,s=[];if(n?n.length>2?s.push({id:e,where:n[1].map((r=>r.val&&r.val.match&&r.val.match(/^"(.*)"$/)?{val:r.val.match(/^"(.*)"$/)[1]}:r))}):s.push({id:e,where:[]}):Cs?s.push(`${"object"==typeof e&&"val"in e?e.val:e}`):"object"==typeof e&&"string"==typeof e.val&&e.val.match(/^[1-9]\d*$|^0$/)?s.push({val:Ls(e.val)}):s.push(e),t&&t.from){const r=t.from.ref;Object.prototype.hasOwnProperty.call(r[0],"val")&&(s[s.length-1]={id:s[s.length-1],where:[r.shift()]}),s.push(...r)}const u={from:{ref:s}};return t&&t.columns&&(u.columns=t.columns),u}(e,s)):(sn=t,t=n)):(sn=t,t=n))),t}function bn(){var t,e,s,u,o,a,c;return t=sn,(e=Mn())!==n&&(t,e=v(e)),(t=e)===n&&(t=sn,(e=Un())!==n&&gs()!==n?(61===r.charCodeAt(sn)?(s=g,sn++):(s=n,0===cn&&dn(m)),s!==n&&gs()!==n&&(u=Mn())!==n?(o=sn,(a=As())!==n&&(c=bn())!==n?o=a=[a,c]:(sn=o,o=n),o===n&&(o=null),o!==n?(t,t=e=function(r,t,e){const n=[r,"=",t];return e&&n.push("and",...e[1]),n}(e,u,o)):(sn=t,t=n)):(sn=t,t=n)):(sn=t,t=n)),t}function yn(){var t,e,s,u,o;return t=sn,(e=Cn())!==n&&(t,e=void((o=e)&&o.apply&&($s.apply=o.apply))),(t=e)===n&&(t=sn,r.substr(sn,11)===b?(e=b,sn+=11):(e=n,0===cn&&dn(y)),e!==n&&(s=gs())!==n?(u=function(){var t,e;t=sn,e=function(){var t,e,s;t=sn,e=[],Me.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(Pe));if(s!==n)for(;s!==n;)e.push(s),Me.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(Pe));else e=n;t=e!==n?r.substring(t,sn):e;return t}(),e===n&&(e=null);e!==n&&(t,e=void Bs(e,{SELECT:$s}));return t=e,t}(),u!==n?t=e=[e,s,u]:(sn=t,t=n)):(sn=t,t=n),t===n&&(t=function(){var t,e,s,u;t=sn,r.substr(sn,3)===N?(e=N,sn+=3):(e=n,0===cn&&dn(D));e===n&&(r.substr(sn,5)===U?(e=U,sn+=5):(e=n,0===cn&&dn(M)),e===n&&(r.substr(sn,12)===P?(e=P,sn+=12):(e=n,0===cn&&dn(G)),e===n&&(r.substr(sn,3)===H?(e=H,sn+=3):(e=n,0===cn&&dn(J)))));e!==n?(61===r.charCodeAt(sn)?(s=g,sn++):(s=n,0===cn&&dn(m)),s!==n&&(u=cs())!==n?t=e=[e,s,u]:(sn=t,t=n)):(sn=t,t=n);return t}(),t===n&&(t=function(){var t,e,s,u,o;t=sn,r.substr(sn,8)===xr?(e=xr,sn+=8):(e=n,0===cn&&dn(Er));if(e!==n){for(s=sn,u=[],yr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Cr));o!==n;)u.push(o),yr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Cr));(s=u!==n?r.substring(s,sn):u)!==n?(t,t=e=function(r){if("json"!==r.toLowerCase()){const r=new Error('Only query parameter "json" is allowed in "$format".');throw r.statusCode=501,r}}(s)):(sn=t,t=n)}else sn=t,t=n;return t}(),t===n&&(t=function(){var t,e,s,u,o;t=sn,e=[],mr.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(br));if(s!==n)for(;s!==n;)e.push(s),mr.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(br));else e=n;if(e!==n)if(61===r.charCodeAt(sn)?(s=g,sn++):(s=n,0===cn&&dn(m)),s!==n){for(u=[],yr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Cr));o!==n;)u.push(o),yr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Cr));u!==n?t=e=[e,s,u]:(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return t}(),t===n&&(t=function(){var t,e,s,u,o;t=sn,e=Rn(),e!==n?(61===r.charCodeAt(sn)?(s=g,sn++):(s=n,0===cn&&dn(m)),s!==n?(u=sn,cn++,o=Rn(),cn--,o===n?u=void 0:(sn=u,u=n),u!==n?(o=function(){var t,e,s,u;t=Mn(),t===n&&(t=Pn())===n&&(t=Gn())===n&&(t=sn,91===r.charCodeAt(sn)?(e=Ar,sn++):(e=n,0===cn&&dn(dr)),e!==n&&(s=Hn())!==n?(93===r.charCodeAt(sn)?(u=vr,sn++):(u=n,0===cn&&dn(gr)),u!==n?(t,t=e={list:s}):(sn=t,t=n)):(sn=t,t=n));return t}(),o!==n?(t,t=e=void Ds($s,e,o)):(sn=t,t=n)):(sn=t,t=n)):(sn=t,t=n)):(sn=t,t=n);return t}()))))),t}function Cn(){var t,e,s,u,o,a,c,i,f,l,h;if(t=sn,r.substr(sn,8)===C?(e=C,sn+=8):(e=n,0===cn&&dn(w)),e!==n)if((s=gs())!==n)if((u=wn())!==n){for(o=[],a=sn,(c=As())!==n&&(i=wn())!==n?a=c=[c,i]:(sn=a,a=n);a!==n;)o.push(a),a=sn,(c=As())!==n&&(i=wn())!==n?a=c=[c,i]:(sn=a,a=n);o!==n?t=e=[e,s,u,o]:(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;else sn=t,t=n;if(t===n){if(t=sn,r.substr(sn,8)===$?(e=$,sn+=8):(e=n,0===cn&&dn(x)),e!==n)if((s=gs())!==n)if((u=En())!==n){for(o=[],a=sn,(c=As())!==n&&(i=En())!==n?a=c=[c,i]:(sn=a,a=n);a!==n;)o.push(a),a=sn,(c=As())!==n&&(i=En())!==n?a=c=[c,i]:(sn=a,a=n);o!==n?(a=function(){var t,e;t=sn,r.substr(sn,7)===Q?(e=Q,sn+=7):(e=n,0===cn&&dn(V));e!==n&&(t,e=function(){const r=new Error('"/$count" is not supported for expand operation');throw r.statusCode=501,r}());return t=e,t}(),a===n&&(a=null),a!==n?t=e=[e,s,u,o,a]:(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;else sn=t,t=n;if(t===n&&(t=sn,r.substr(sn,8)===E?(e=E,sn+=8):(e=n,0===cn&&dn(L)),e!==n&&(s=gs())!==n&&(u=jn())!==n?(t,h=u,t=e=void($s.where=h)):(sn=t,t=n),t===n)){if(t=sn,r.substr(sn,9)===B?(e=B,sn+=9):(e=n,0===cn&&dn(S)),e!==n)if((s=gs())!==n)if((u=_n())!==n){for(o=[],a=sn,(c=As())!==n&&(i=_n())!==n?(a,a=c=T(0,i)):(sn=a,a=n);a!==n;)o.push(a),a=sn,(c=As())!==n&&(i=_n())!==n?(a,a=c=T(0,i)):(sn=a,a=n);o!==n?(t,t=e=void qs(u,!0)):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;else sn=t,t=n;t===n&&(t=sn,r.substr(sn,5)===j?(e=j,sn+=5):(e=n,0===cn&&dn(k)),e!==n&&(s=gs())!==n&&(u=Ln())!==n?(t,l=u,t=e=void(($s.limit||($s.limit={})).rows={val:l})):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,6)===O?(e=O,sn+=6):(e=n,0===cn&&dn(Z)),e!==n&&(s=gs())!==n&&(u=Bn())!==n?(t,e=function(r){Rs(r)}(u),t=e):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,8)===z?(e=z,sn+=8):(e=n,0===cn&&dn(_)),e!==n&&(s=gs())!==n&&(u=Sn())!==n?(t,t=e=void((f=u)&&($s.search=f))):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,7)===F?(e=F,sn+=7):(e=n,0===cn&&dn(R)),e!==n&&(s=gs())!==n?(u=function(){var r,t;r=sn,t=os(),t!==n&&(r,t=function(r){r&&($s.count=!0)}(t));return r=t,r}(),u!==n?t=e=[e,s,u]:(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,7)===q?(e=q,sn+=7):(e=n,0===cn&&dn(I)),e!==n&&(s=gs())!==n&&(u=Fn())!==n?(t,t=e=u):(sn=t,t=n))))))}}return t}function wn(){var t,e,s;return t=sn,42===r.charCodeAt(sn)?(e="*",sn++):(e=n,0===cn&&dn(K)),e===n&&(e=Un()),e!==n&&(t,s=e,$s.columns=Array.isArray($s.columns)?$s.columns:[],$s.columns.find(Ts(s))||$s.columns.push(s),e=s),t=e}function $n(){var t,e,s,u,o;for(t=sn,e=[],s=sn,(u=Cn())!==n&&gs()!==n?(59===r.charCodeAt(sn)?(o=";",sn++):(o=n,0===cn&&dn(W)),o===n&&(o=null),o!==n?(s,s=u):(sn=s,s=n)):(sn=s,s=n);s!==n;)e.push(s),s=sn,(u=Cn())!==n&&gs()!==n?(59===r.charCodeAt(sn)?(o=";",sn++):(o=n,0===cn&&dn(W)),o===n&&(o=null),o!==n?(s,s=u):(sn=s,s=n)):(sn=s,s=n);return e!==n&&(t,e=function(r){if(r.find((r=>r&&void 0!==r.apply))){const r=new Error('"$apply" is not supported for expand operation');throw r.statusCode=501,r}if($s.columns){for(const r of $s.columns)$s.expand.find(Ts(r))||$s.expand.push(r);delete $s.columns}else Array.isArray($s.expand)&&-1===$s.expand.indexOf("*")&&$s.expand.unshift("*")}(e)),t=e}function xn(){var r,t,e,s,u;return r=sn,t=sn,(e=ds())!==n&&(t,ws.push($s),$s=$s.expand[$s.expand.length-1],e=void($s.expand=[])),(t=e)!==n?((e=$n())===n&&(e=null),e!==n?(s=sn,(u=vs())!==n&&(s,$s.expand.length||$s.expand.push("*"),u=void($s=ws.pop())),(s=u)!==n?r=t=[t,e,s]:(sn=r,r=n)):(sn=r,r=n)):(sn=r,r=n),r}function En(){var t,e,s;return t=sn,e=sn,42===r.charCodeAt(sn)?(s="*",sn++):(s=n,0===cn&&dn(K)),s===n&&(s=Un()),s!==n&&(e,s=function(r){const t="*"===r?{}:r;return t.expand=["*"],Array.isArray($s.expand)||($s.expand=[]),$s.expand.find(Ts(t))||$s.expand.push(t),t}(s)),(e=s)!==n?((s=xn())===n&&(s=null),s!==n?t=e=[e,s]:(sn=t,t=n)):(sn=t,t=n),t}function Ln(){var r,t;return r=sn,(t=is())!==n&&r,r=t}function Bn(){var r,t;return r=sn,(t=is())!==n&&r,r=t}function Sn(){var r,t;return r=sn,(t=Tn())!==n&&r,(r=t)===n&&(r=gs()),r}function Tn(){var t,e,s,u,o,a,c;if(t=sn,e=sn,(s=Kn())===n&&(s=null),s!==n&&(e,s=X(s)),(e=s)!==n)if(s=sn,(u=ds())!==n&&(o=Tn())!==n&&(a=vs())!==n?(s,s=u=Y(e,o)):(sn=s,s=n),s===n&&(s=sn,u=function(){var t,e,s,u,o;cn++,t=sn,34===r.charCodeAt(sn)?(e=ie,sn++):(e=n,0===cn&&dn(fe));if(e!==n){for(s=sn,u=[],r.substr(sn,2)===le?(o=le,sn+=2):(o=n,0===cn&&dn(he)),o===n&&(pe.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Ae)));o!==n;)u.push(o),r.substr(sn,2)===le?(o=le,sn+=2):(o=n,0===cn&&dn(he)),o===n&&(pe.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Ae)));(s=u!==n?r.substring(s,sn):u)!==n?(34===r.charCodeAt(sn)?(u=ie,sn++):(u=n,0===cn&&dn(fe)),u!==n?(t,t=e=s.replace(/\\\\/g,"\\").replace(/\\"/g,'"')):(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;cn--,t===n&&(e=n,0===cn&&dn(ce));return t}(),u!==n&&(s,u=rr(e,u)),(s=u)===n&&(s=sn,(u=as())!==n&&(s,u=rr(e,u)),(s=u)===n&&(s=sn,u=function(){var t,e,s;cn++,t=sn,e=[],ve.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(ge));if(s!==n)for(;s!==n;)e.push(s),ve.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(ge));else e=n;t=e!==n?r.substring(t,sn):e;cn--,t===n&&(e=n,0===cn&&dn(de));return t}(),u!==n&&(s,u=rr(e,u)),s=u))),s!==n){for(u=[],o=sn,(a=Qn())===n&&(a=Wn())===n&&(a=Vn()),a!==n&&(c=Tn())!==n?(o,o=a=tr(e,a,c)):(sn=o,o=n);o!==n;)u.push(o),o=sn,(a=Qn())===n&&(a=Wn())===n&&(a=Vn()),a!==n&&(c=Tn())!==n?(o,o=a=tr(e,a,c)):(sn=o,o=n);u!==n?(t,t=e):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return t}function jn(){var r,t;return r=sn,(t=kn())!==n&&r,r=t}function kn(){var t,e,s,u,o,a,c,i;if(t=sn,e=sn,(s=Kn())===n&&(s=null),s!==n&&(e,s=X(s)),(e=s)!==n)if(s=sn,(u=ds())!==n&&(o=kn())!==n&&(a=vs())!==n?(s,s=u=Y(e,o)):(sn=s,s=n),s===n&&(s=sn,(u=qn())!==n&&(s,i=u,u=void e.push(...i)),(s=u)===n&&(s=sn,(u=On())!==n&&(s,u=function(r,t){"not"===r[r.length-1]&&"not"===t[0]?r.push("(",...t,")"):r.push(...t)}(e,u)),(s=u)===n&&(s=sn,u=function(){var t,e,s,u;t=sn,r.substr(sn,8).toLowerCase()===st?(e=r.substr(sn,8),sn+=8):(e=n,0===cn&&dn(ut));e===n&&(r.substr(sn,8).toLowerCase()===ot?(e=r.substr(sn,8),sn+=8):(e=n,0===cn&&dn(at)),e===n&&(r.substr(sn,10).toLowerCase()===ct?(e=r.substr(sn,10),sn+=10):(e=n,0===cn&&dn(it))));e!==n&&ds()!==n&&(s=Dn())!==n&&As()!==n&&(u=Dn())!==n&&vs()!==n?(t,o=s,a=u,t=e={func:e.toLowerCase(),args:[o,a]}):(sn=t,t=n);var o,a;return t}(),u!==n&&(s,u=function(r,t){r.push(t)}(e,u)),(s=u)===n&&(s=sn,(u=os())!==n&&(s,u=rr(e,u)),(s=u)===n&&(s=sn,(u=Nn())!==n&&(s,u=function(r,t){r.push(...t)}(e,u)),s=u))))),s!==n){for(u=[],o=sn,(a=Qn())===n&&(a=Wn()),a!==n&&(c=kn())!==n?(o,o=a=tr(e,a,c)):(sn=o,o=n);o!==n;)u.push(o),o=sn,(a=Qn())===n&&(a=Wn()),a!==n&&(c=kn())!==n?(o,o=a=tr(e,a,c)):(sn=o,o=n);u!==n?(t,t=e):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return t}function On(){var t,e,s,u,c,i,f;if(t=sn,e=sn,(s=fs())!==n&&(e,s=[s]),(e=s)!==n)if(47===r.charCodeAt(sn)?(s=o,sn++):(s=n,0===cn&&dn(a)),s!==n){for(u=[],c=sn,(i=fs())!==n?(47===r.charCodeAt(sn)?(f=o,sn++):(f=n,0===cn&&dn(a)),f!==n?(c,c=i=er(e,i)):(sn=c,c=n)):(sn=c,c=n);c!==n;)u.push(c),c=sn,(i=fs())!==n?(47===r.charCodeAt(sn)?(f=o,sn++):(f=n,0===cn&&dn(a)),f!==n?(c,c=i=er(e,i)):(sn=c,c=n)):(sn=c,c=n);u!==n?(c=sn,i=function(){var t,e,s;t=sn,r.substr(sn,3)===or?(e=or,sn+=3):(e=n,0===cn&&dn(ar));e!==n&&ds()!==n?((s=zn())===n&&(s=null),s!==n&&vs()!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n);return t}(),i!==n&&(c,i=function(r,t){let e=r.pop();if(!t)return["exists",{ref:[...r,{id:e}]}];let n=[];for(let r=0,s=0;r<t.length;++r){let u=t[r];u.ref&&0===u.ref.length&&"="===t[r+1]?n[s++]={func:"contains",args:[{ref:[e]},t[r+=2]]}:n[s++]=u}return n.length<t.length?r.length?(e=r.pop(),["exists",{ref:[...r,{id:e,where:n}]}]):n:["exists",{ref:[...r,{id:e,where:t}]}]}(e,i)),(c=i)===n&&(c=sn,i=function(){var t,e,s;t=sn,r.substr(sn,3)===cr?(e=cr,sn+=3):(e=n,0===cn&&dn(ir));e!==n&&ds()!==n&&(s=zn())!==n&&vs()!==n?(t,t=e=s):(sn=t,t=n);return t}(),i!==n&&(c,i=function(r,t){let e=r.pop();return["not","exists",{ref:[...r,{id:e,where:["not",{xpr:[...t]}]}]}]}(e,i)),c=i),c!==n?(t,t=e=c):(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return t}function Zn(){var r,t,e,s,u,o,a,c,i;if(r=sn,t=sn,(e=Kn())===n&&(e=null),e!==n&&(t,e=(c=e)?[c]:[]),(t=e)!==n)if(e=sn,(s=ds())!==n&&(u=Zn())!==n&&(o=vs())!==n?(e,i=u,e=s=void t.push("(",...i,")")):(sn=e,e=n),e===n&&(e=sn,(s=qn())!==n&&(e,s=function(r,t){r.push(...t)}(t,s)),(e=s)===n&&(e=sn,(s=Jn())!==n&&(e,s=function(r,t){r.push(t)}(t,s)),(e=s)===n&&(e=sn,(s=On())!==n&&(e,s=function(r,t){r.push(...t)}(t,s)),(e=s)===n&&(e=sn,(s=Nn())!==n&&(e,s=function(r,t){r.push(...t)}(t,s)),e=s)))),e!==n){for(s=[],u=sn,(o=Qn())===n&&(o=Wn()),o!==n&&(a=Zn())!==n?(u,u=o=nr(t,o,a)):(sn=u,u=n);u!==n;)s.push(u),u=sn,(o=Qn())===n&&(o=Wn()),o!==n&&(a=Zn())!==n?(u,u=o=nr(t,o,a)):(sn=u,u=n);s!==n?(r,r=t):(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;return r}function zn(){var t,e,s,u;return t=sn,(e=fs())!==n?(58===r.charCodeAt(sn)?(s=sr,sn++):(s=n,0===cn&&dn(ur)),s!==n&&(u=Zn())!==n?(t,t=e=Is(e,u)):(sn=t,t=n)):(sn=t,t=n),t}function _n(){var t,e,s,u,o,a;return t=sn,e=sn,(s=On())!==n&&(e,s=function(){const r=new Error('"$orderby" does not support lambda');throw r.statusCode=501,r}()),(e=s)===n&&(e=Jn())===n&&(e=Un()),e!==n?(s=sn,ms()!==n?(u=sn,"asc"===r.substr(sn,3)?(o="asc",sn+=3):(o=n,0===cn&&dn(fr)),o===n&&(r.substr(sn,4)===lr?(o=lr,sn+=4):(o=n,0===cn&&dn(hr))),(u=o!==n?r.substring(u,sn):o)!==n?(s,s=u):(sn=s,s=n)):(sn=s,s=n),s===n&&(s=null),s!==n?(t,t=e=bs(e,(a=s)&&{sort:a})):(sn=t,t=n)):(sn=t,t=n),t}function Fn(){var t,e,s,u,c,i;if(t=sn,(e=Xn())!==n){for(s=[],u=sn,47===r.charCodeAt(sn)?(c=o,sn++):(c=n,0===cn&&dn(a)),c!==n&&(i=Xn())!==n?(u,u=c=pr(0,i)):(sn=u,u=n);u!==n;)s.push(u),u=sn,47===r.charCodeAt(sn)?(c=o,sn++):(c=n,0===cn&&dn(a)),c!==n&&(i=Xn())!==n?(u,u=c=pr(0,i)):(sn=u,u=n);s!==n?(t,t=e=function(r,t){if(void 0!==r){t=Array.isArray(t)?t:[t];for(let e of t)for(const t in e)if("limit"===t&&e.limit&&r.limit&&r.limit.offset&&e.limit.rows)r.limit.rows=e.limit.rows;else if(r[t]||"groupBy"===t&&(r.where||r.search)||"aggregate"===t&&"groupBy"in r&&!("groupBy"in e)){let n=r;r={apply:n},"limit"===t&&e[t].offset&&n.limit&&n.limit.offset&&n.limit.offset.val&&(e[t].offset+=n.limit.offset.val),n=r,n[t]=e[t]}else r[t]=e[t];return{apply:r}}}(e,s)):(sn=t,t=n)}else sn=t,t=n;return t}function Rn(){var t,e,s;return cn++,t=sn,64===r.charCodeAt(sn)?(e="@",sn++):(e=n,0===cn&&dn($r)),e!==n&&(s=fs())!==n?(t,t=e="@"+s):(sn=t,t=n),cn--,t===n&&(e=n,0===cn&&dn(wr)),t}function qn(){var t,e,s,u,o,a;return t=sn,(e=Dn())!==n&&ms()!==n?(s=sn,"eq"===r.substr(sn,2)?(u="eq",sn+=2):(u=n,0===cn&&dn(Lr)),u===n&&("ne"===r.substr(sn,2)?(u="ne",sn+=2):(u=n,0===cn&&dn(Br)),u===n&&("lt"===r.substr(sn,2)?(u="lt",sn+=2):(u=n,0===cn&&dn(Sr)),u===n&&("gt"===r.substr(sn,2)?(u="gt",sn+=2):(u=n,0===cn&&dn(Tr)),u===n&&("le"===r.substr(sn,2)?(u="le",sn+=2):(u=n,0===cn&&dn(jr)),u===n&&("ge"===r.substr(sn,2)?(u="ge",sn+=2):(u=n,0===cn&&dn(kr))))))),(s=u!==n?r.substring(s,sn):u)!==n&&(u=ms())!==n&&(o=Dn())!==n?(t,t=e=[e,{eq:"=",ne:"!=",lt:"<",gt:">",le:"<=",ge:">="}[a=s]||a,o]):(sn=t,t=n)):(sn=t,t=n),t}function In(){var r,t;return r=sn,(t=Rn())!==n&&(r,t={list:t}),(r=t)===n&&(r=function(){var r,t,e;cn++,r=sn,t=ds(),t!==n&&(e=Hn())!==n&&vs()!==n?(r,r=t={list:e}):(sn=r,r=n);cn--,r===n&&(t=n,0===cn&&dn(Vr));return r}()),r}function Nn(){var t,e,s,u;return t=sn,(e=Dn())!==n&&ms()!==n?("in"===r.substr(sn,2)?(s="in",sn+=2):(s=n,0===cn&&dn(Or)),s!==n&&ms()!==n&&(u=In())!==n?(t,t=e=[e,"in",u]):(sn=t,t=n)):(sn=t,t=n),t}function Dn(){var t;return(t=function(){var t,e,s,u,c,i,h;cn++,t=sn,e=[],s=sn,(u=fs())!==n?(c=sn,(i=ds())!==n&&(h=bn())!==n&&vs()!==n?(c,c=i=zr(0,h)):(sn=c,c=n),c===n&&(c=null),c!==n?(47===r.charCodeAt(sn)?(i=o,sn++):(i=n,0===cn&&dn(a)),i!==n?(s,s=u=_r(u,c)):(sn=s,s=n)):(sn=s,s=n)):(sn=s,s=n);if(s!==n)for(;s!==n;)e.push(s),s=sn,(u=fs())!==n?(c=sn,(i=ds())!==n&&(h=bn())!==n&&vs()!==n?(c,c=i=zr(0,h)):(sn=c,c=n),c===n&&(c=null),c!==n?(47===r.charCodeAt(sn)?(i=o,sn++):(i=n,0===cn&&dn(a)),i!==n?(s,s=u=_r(u,c)):(sn=s,s=n)):(sn=s,s=n)):(sn=s,s=n);else e=n;e!==n?(r.substr(sn,6)===f?(s=f,sn+=6):(s=n,0===cn&&dn(l)),s!==n?(t,t=e={func:"count",as:"$count",args:[{ref:e}]}):(sn=t,t=n)):(sn=t,t=n);cn--,t===n&&(e=n,0===cn&&dn(Zr));return t}())===n&&(t=Jn())===n&&(t=Mn())===n&&(t=Un())===n&&(t=Pn())===n&&(t=Gn())===n&&(t=function(){var t,e,s,u,o;cn++,t=sn,91===r.charCodeAt(sn)?(e=Ar,sn++):(e=n,0===cn&&dn(dr));if(e!==n){for(s=sn,u=[],Kr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Qr));o!==n;)u.push(o),Kr.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Qr));(s=u!==n?r.substring(s,sn):u)!==n?(93===r.charCodeAt(sn)?(u=vr,sn++):(u=n,0===cn&&dn(gr)),u!==n?(t,t=e={list:s.replace(/"/g,"").split(",").map((r=>({val:r})))}):(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;cn--,t===n&&(e=n,0===cn&&dn(Vr));return t}()),t}function Un(){var t,e,s,u,c,i,f,l;if(cn++,t=sn,(e=fs())!==n){for(s=[],u=sn,47===r.charCodeAt(sn)?(c=o,sn++):(c=n,0===cn&&dn(a)),c!==n&&(i=fs())!==n?(u,u=c=Rr(0,i)):(sn=u,u=n);u!==n;)s.push(u),u=sn,47===r.charCodeAt(sn)?(c=o,sn++):(c=n,0===cn&&dn(a)),c!==n&&(i=fs())!==n?(u,u=c=Rr(0,i)):(sn=u,u=n);s!==n?(t,l=s,t=e="null"===(f=e)?{val:null}:{ref:[f,...l]}):(sn=t,t=n)}else sn=t,t=n;return cn--,t===n&&(e=n,0===cn&&dn(Fr)),t}function Mn(){var t,e,s;return t=sn,(e=os())===n&&(e=cs()),e!==n&&(t,e=qr(e)),(t=e)===n&&(t=sn,(e=ls())!==n&&(t,e=qr(e)),(t=e)===n&&(t=sn,e=function(){var t,e,s,u,o,a,c,i,f,l,h;cn++,t=sn,e=sn,cn++,s=function(){var t,e,s;t=sn,e=[],be.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(ye));if(s!==n)for(;s!==n;)e.push(s),be.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(ye));else e=n;e!==n?(45===r.charCodeAt(sn)?(s=Ce,sn++):(s=n,0===cn&&dn(we)),s!==n?t=e=[e,s]:(sn=t,t=n)):(sn=t,t=n);return t}(),cn--,s===n?e=void 0:(sn=e,e=n);if(e!==n){if(s=sn,u=sn,Se.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Te)),o===n&&(o=null),o!==n){if(a=[],be.test(r.charAt(sn))?(c=r.charAt(sn),sn++):(c=n,0===cn&&dn(ye)),c!==n)for(;c!==n;)a.push(c),be.test(r.charAt(sn))?(c=r.charAt(sn),sn++):(c=n,0===cn&&dn(ye));else a=n;if(a!==n){if(c=sn,46===r.charCodeAt(sn)?(i=".",sn++):(i=n,0===cn&&dn(xe)),i!==n){if(f=[],be.test(r.charAt(sn))?(l=r.charAt(sn),sn++):(l=n,0===cn&&dn(ye)),l!==n)for(;l!==n;)f.push(l),be.test(r.charAt(sn))?(l=r.charAt(sn),sn++):(l=n,0===cn&&dn(ye));else f=n;f!==n?c=i=[i,f]:(sn=c,c=n)}else sn=c,c=n;if(c===n&&(c=null),c!==n){if(i=sn,101===r.charCodeAt(sn)?(f="e",sn++):(f=n,0===cn&&dn(je)),f!==n){if(l=[],be.test(r.charAt(sn))?(h=r.charAt(sn),sn++):(h=n,0===cn&&dn(ye)),h!==n)for(;h!==n;)l.push(h),be.test(r.charAt(sn))?(h=r.charAt(sn),sn++):(h=n,0===cn&&dn(ye));else l=n;l!==n?i=f=[f,l]:(sn=i,i=n)}else sn=i,i=n;i===n&&(i=null),i!==n?u=o=[o,a,c,i]:(sn=u,u=n)}else sn=u,u=n}else sn=u,u=n}else sn=u,u=n;(s=u!==n?r.substring(s,sn):u)!==n?(t,t=e=Ls(s)):(sn=t,t=n)}else sn=t,t=n;cn--,t===n&&(e=n,0===cn&&dn(Be));return t}(),e!==n&&(t,e="number"==typeof(s=e)?{val:s}:{val:s,literal:"number"}),(t=e)===n&&(t=sn,(e=as())!==n&&(t,e=qr(e)),(t=e)===n&&(t=sn,e=function(){var t,e,s,u,o,a;cn++,t=sn,r.substr(sn,7)===He?(e=He,sn+=7):(e=n,0===cn&&dn(Je));if(e!==n){if(s=sn,u=sn,o=[],Ke.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(Qe)),a!==n)for(;a!==n;)o.push(a),Ke.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(Qe));else o=n;o!==n?(r.substr(sn,2)===Ve?(a=Ve,sn+=2):(a=n,0===cn&&dn(We)),a===n&&(61===r.charCodeAt(sn)?(a=g,sn++):(a=n,0===cn&&dn(m))),a===n&&(a=null),a!==n?u=o=[o,a]:(sn=u,u=n)):(sn=u,u=n),(s=u!==n?r.substring(s,sn):u)!==n?(39===r.charCodeAt(sn)?(u=ee,sn++):(u=n,0===cn&&dn(ne)),u!==n?(t,t=e=Ss(s)):(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;cn--,t===n&&(e=n,0===cn&&dn(Ge));return t}(),e!==n&&(t,e=qr(e)),(t=e)===n&&(t=sn,(e=Rn())!==n&&(t,e=qr(e)),(t=e)===n&&(t=function(){var t,e;cn++,t=sn,r.substr(sn,4)===Nr?(e=Nr,sn+=4):(e=n,0===cn&&dn(Dr));e!==n&&(t,e={val:null});t=e,cn--,t===n&&(e=n,0===cn&&dn(Ir));return t}())))))),t}function Pn(){var t,e,s,u,o,a;if(cn++,t=sn,e=sn,s=sn,123===r.charCodeAt(sn)?(u="{",sn++):(u=n,0===cn&&dn(Mr)),u!==n){for(o=[],(a=Pn())===n&&(Pr.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(Gr)));a!==n;)o.push(a),(a=Pn())===n&&(Pr.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(Gr)));o!==n?(125===r.charCodeAt(sn)?(a="}",sn++):(a=n,0===cn&&dn(Hr)),a!==n?s=u=[u,o,a]:(sn=s,s=n)):(sn=s,s=n)}else sn=s,s=n;return(e=s!==n?r.substring(e,sn):s)!==n&&(t,e=qr(e)),cn--,(t=e)===n&&(e=n,0===cn&&dn(Ur)),t}function Gn(){var t,e,s,u,o,a,c,i;if(cn++,t=sn,e=sn,s=sn,91===r.charCodeAt(sn)?(u=Ar,sn++):(u=n,0===cn&&dn(dr)),u!==n&&(o=gs())!==n?(93===r.charCodeAt(sn)?(a=vr,sn++):(a=n,0===cn&&dn(gr)),a!==n?s=u=[u,o,a]:(sn=s,s=n)):(sn=s,s=n),s===n)if(s=sn,91===r.charCodeAt(sn)?(u=Ar,sn++):(u=n,0===cn&&dn(dr)),u!==n)if((o=gs())!==n)if(123===r.charCodeAt(sn)?(a="{",sn++):(a=n,0===cn&&dn(Mr)),a!==n){for(c=[],(i=Gn())===n&&(Kr.test(r.charAt(sn))?(i=r.charAt(sn),sn++):(i=n,0===cn&&dn(Qr)));i!==n;)c.push(i),(i=Gn())===n&&(Kr.test(r.charAt(sn))?(i=r.charAt(sn),sn++):(i=n,0===cn&&dn(Qr)));c!==n?(93===r.charCodeAt(sn)?(i=vr,sn++):(i=n,0===cn&&dn(gr)),i!==n?s=u=[u,o,a,c,i]:(sn=s,s=n)):(sn=s,s=n)}else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;return(e=s!==n?r.substring(e,sn):s)!==n&&(t,e=qr(e)),cn--,(t=e)===n&&(e=n,0===cn&&dn(Jr)),t}function Hn(){var t,e,s,u,o,a,c;if(t=sn,(e=Mn())!==n){for(s=[],u=sn,44===r.charCodeAt(sn)?(o=",",sn++):(o=n,0===cn&&dn(Wr)),o!==n&&(a=Mn())!==n?(u,u=o=Xr(0,a)):(sn=u,u=n);u!==n;)s.push(u),u=sn,44===r.charCodeAt(sn)?(o=",",sn++):(o=n,0===cn&&dn(Wr)),o!==n&&(a=Mn())!==n?(u,u=o=Xr(0,a)):(sn=u,u=n);s!==n?(t,c=s,t=e=[e,...c]):(sn=t,t=n)}else sn=t,t=n;return t}function Jn(){var t,e,s;return t=sn,e=function(){var t,e,s;if(cn++,t=sn,e=[],rt.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(tt)),s!==n)for(;s!==n;)e.push(s),rt.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(tt));else e=n;return t=e!==n?r.substring(t,sn):e,cn--,t===n&&(e=n,0===cn&&dn(Yr)),t}(),e!==n&&ds()!==n?(s=function(){var r,t,e,s,u,o,a;if(r=sn,t=[],e=sn,s=Dn(),s!==n){for(u=[],o=sn,As()!==n&&(a=Dn())!==n?(o,o=et(0,a)):(sn=o,o=n);o!==n;)u.push(o),o=sn,As()!==n&&(a=Dn())!==n?(o,o=et(0,a)):(sn=o,o=n);u!==n?(e,e=s=nt(s,u)):(sn=e,e=n)}else sn=e,e=n;for(;e!==n;)if(t.push(e),e=sn,(s=Dn())!==n){for(u=[],o=sn,As()!==n&&(a=Dn())!==n?(o,o=et(0,a)):(sn=o,o=n);o!==n;)u.push(o),o=sn,As()!==n&&(a=Dn())!==n?(o,o=et(0,a)):(sn=o,o=n);u!==n?(e,e=s=nt(s,u)):(sn=e,e=n)}else sn=e,e=n;t!==n&&(r,t=(c=t).length?c[0]:c);var c;return r=t,r}(),s!==n&&vs()!==n?(t,t=e=function(r,t){if(ys&&!(r.toLowerCase()in ys.functions))throw Object.assign(new Error(`"${r}" is an unknown function in OData URL spec (strict mode)`),{statusCode:400});return{func:r.toLowerCase(),args:t}}(e,s)):(sn=t,t=n)):(sn=t,t=n),t}function Kn(){var t,e;return t=sn,gs()!==n?("not"===r.substr(sn,3).toLowerCase()?(e=r.substr(sn,3),sn+=3):(e=n,0===cn&&dn(ft)),e!==n&&ms()!==n?(t,t="not"):(sn=t,t=n)):(sn=t,t=n),t}function Qn(){var t,e;return t=sn,ms()!==n?("and"===r.substr(sn,3).toLowerCase()?(e=r.substr(sn,3),sn+=3):(e=n,0===cn&&dn(lt)),e!==n&&ms()!==n?(t,t="and"):(sn=t,t=n)):(sn=t,t=n),t}function Vn(){var r,t;return r=sn,(t=ms())!==n&&(r,t="and"),r=t}function Wn(){var t,e;return t=sn,ms()!==n?("or"===r.substr(sn,2).toLowerCase()?(e=r.substr(sn,2),sn+=2):(e=n,0===cn&&dn(ht)),e!==n&&ms()!==n?(t,t="or"):(sn=t,t=n)):(sn=t,t=n),t}function Xn(){var t,e,s;return t=sn,r.substr(sn,9)===pt?(e=pt,sn+=9):(e=n,0===cn&&dn(At)),e!==n?(s=function(){var r,t,e,s,u,o;if(r=sn,t=ds(),t!==n)if(gs()!==n)if((e=Yn())!==n){for(s=[],u=sn,gs()!==n&&As()!==n&&gs()!==n&&(o=Yn())!==n?(u,u=Ft(0,o)):(sn=u,u=n);u!==n;)s.push(u),u=sn,gs()!==n&&As()!==n&&gs()!==n&&(o=Yn())!==n?(u,u=Ft(0,o)):(sn=u,u=n);s!==n&&(u=gs())!==n&&vs()!==n?(r,a=s,r=t={aggregate:[e,...a]}):(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;else sn=r,r=n;var a;return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,7)===dt?(e=dt,sn+=7):(e=n,0===cn&&dn(vt)),e!==n?(s=function(){var r,t,e,s,u,o,a,c;if(r=sn,t=ds(),t!==n)if(ds()!==n)if((e=ss())!==n){for(s=[],u=sn,(o=As())!==n&&(a=ss())!==n?(u,u=o=Ft(0,a)):(sn=u,u=n);u!==n;)s.push(u),u=sn,(o=As())!==n&&(a=ss())!==n?(u,u=o=Ft(0,a)):(sn=u,u=n);s!==n?(u=sn,(o=vs())!==n&&(u,i=s,o={groupBy:[e,...i]}),(u=o)!==n?(o=sn,(a=As())!==n&&(c=Fn())!==n?(o,o=a=c):(sn=o,o=n),o===n&&(o=null),o!==n&&(a=vs())!==n?(r,t=function(r,t,e){let n={};return n=e?{groupBy:[r,...t],...e.apply}:{groupBy:[r,...t]},n}(e,s,o),r=t):(sn=r,r=n)):(sn=r,r=n)):(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;else sn=r,r=n;var i;return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,6)===gt?(e=gt,sn+=6):(e=n,0===cn&&dn(mt)),e!==n?(s=function(){var r,t,e,s;r=sn,t=ds(),t!==n&&gs()!==n?(e=sn,(s=jn())!==n&&e,(e=s)!==n&&(s=gs())!==n&&vs()!==n?(r,r=t={where:e}):(sn=r,r=n)):(sn=r,r=n);return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,6)===bt?(e=bt,sn+=6):(e=n,0===cn&&dn(yt)),e!==n?(s=function(){var r,t,e,s;r=sn,t=ds(),t!==n&&gs()!==n?(e=sn,(s=Sn())!==n&&(e,s=function(r){if(r)return r}(s)),(e=s)!==n&&(s=gs())!==n&&vs()!==n?(r,r=t={search:e}):(sn=r,r=n)):(sn=r,r=n);return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,6)===Ct?(e=Ct,sn+=6):(e=n,0===cn&&dn(wt)),e!==n?(s=function(){var r,t,e,s,u,o;if(r=sn,t=ds(),t!==n)if(gs()!==n)if((e=Fn())!==n){if(s=[],u=sn,gs()!==n&&As()!==n&&gs()!==n&&(o=Fn())!==n?(u,u=Ht(0,o)):(sn=u,u=n),u!==n)for(;u!==n;)s.push(u),u=sn,gs()!==n&&As()!==n&&gs()!==n&&(o=Fn())!==n?(u,u=Ht(0,o)):(sn=u,u=n);else s=n;s!==n&&(u=gs())!==n&&vs()!==n?(r,a=s,r=t={concat:[e,...a]}):(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;else sn=r,r=n;var a;return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,7)===$t?(e=$t,sn+=7):(e=n,0===cn&&dn(xt)),e!==n?(s=function(){var r,t,e,s,u,o,a,c,i,f;if(r=sn,t=ds(),t!==n)if((e=gs())!==n)if((s=us())!==n){for(u=[],o=sn,(a=gs())!==n&&(c=As())!==n&&(i=gs())!==n&&(f=us())!==n?o=a=[a,c,i,f]:(sn=o,o=n);o!==n;)u.push(o),o=sn,(a=gs())!==n&&(c=As())!==n&&(i=gs())!==n&&(f=us())!==n?o=a=[a,c,i,f]:(sn=o,o=n);u!==n&&(o=gs())!==n&&(a=vs())!==n?r=t=[t,e,s,u,o,a]:(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;else sn=r,r=n;return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,"top"===r.substr(sn,3)?(e="top",sn+=3):(e=n,0===cn&&dn(Et)),e!==n?(s=function(){var r,t,e;r=sn,t=ds(),t!==n&&gs()!==n&&(e=Ln())!==n&&gs()!==n&&vs()!==n?(r,r=t={limit:{rows:{val:e}}}):(sn=r,r=n);return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,4)===Lt?(e=Lt,sn+=4):(e=n,0===cn&&dn(Bt)),e!==n?(s=function(){var r,t,e;r=sn,t=ds(),t!==n&&gs()!==n&&(e=Bn())!==n&&gs()!==n&&vs()!==n?(r,r=t={limit:{offset:{val:e}}}):(sn=r,r=n);return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,r.substr(sn,7)===St?(e=St,sn+=7):(e=n,0===cn&&dn(Tt)),e!==n?(s=function(){var r,t,e,s,u,o;if(r=sn,t=ds(),t!==n)if(gs()!==n)if((e=_n())!==n){for(s=[],u=sn,As()!==n&&(o=_n())!==n?(u,u=Qt(0,o)):(sn=u,u=n);u!==n;)s.push(u),u=sn,As()!==n&&(o=_n())!==n?(u,u=Qt(0,o)):(sn=u,u=n);s!==n&&(u=gs())!==n&&vs()!==n?(r,a=s,r=t={orderBy:[e,...a]}):(sn=r,r=n)}else sn=r,r=n;else sn=r,r=n;else sn=r,r=n;var a;return r}(),s!==n?(t,t=e=s):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,"topcount"===r.substr(sn,8).toLowerCase()?(e=r.substr(sn,8),sn+=8):(e=n,0===cn&&dn(jt)),e===n&&("bottomcount"===r.substr(sn,11).toLowerCase()?(e=r.substr(sn,11),sn+=11):(e=n,0===cn&&dn(kt)),e===n&&("topsum"===r.substr(sn,6).toLowerCase()?(e=r.substr(sn,6),sn+=6):(e=n,0===cn&&dn(Ot)),e===n&&("bottomsum"===r.substr(sn,9).toLowerCase()?(e=r.substr(sn,9),sn+=9):(e=n,0===cn&&dn(Zt)),e===n&&("toppercent"===r.substr(sn,10).toLowerCase()?(e=r.substr(sn,10),sn+=10):(e=n,0===cn&&dn(zt)),e===n&&("bottompercent"===r.substr(sn,13).toLowerCase()?(e=r.substr(sn,13),sn+=13):(e=n,0===cn&&dn(_t))))))),e!==n?(s=function(){var r,t,e,s;r=sn,t=ds(),t!==n&&gs()!==n&&(e=Dn())!==n&&gs()!==n&&As()!==n&&gs()!==n&&(s=Dn())!==n&&gs()!==n&&vs()!==n?(r,r=t=[e,s]):(sn=r,r=n);return r}(),s!==n?(t,t=e=function(r,t){if(!{topcount:!0,bottomcount:!0,topsum:!1,bottomsum:!1,toppercent:!1,bottompercent:!1}[r=r.toLowerCase()])throw Object.assign(new Error(`Transformation "${r}" in $apply is not yet supported.`),{statusCode:501});return{aggregate:[{func:r,args:t}]}}(e,s)):(sn=t,t=n)):(sn=t,t=n),t===n&&(t=sn,e=function(){var t,e;t=sn,r.substr(sn,8)===Jt?(e=Jt,sn+=8):(e=n,0===cn&&dn(Kt));e!==n&&(t,e={identity:!0});return t=e,t}(),e!==n&&t,t=e)))))))))),t}function Yn(){var t,e,s,u;return t=sn,e=sn,r.substr(sn,6)===f?(s=f,sn+=6):(s=n,0===cn&&dn(l)),s!==n&&(u=ns())!==n?(e,e=s={func:"count",args:[{val:1}],as:u}):(sn=e,e=n),e===n&&(e=rs()),e!==n&&t,t=e}function rs(){var r,t,e,s,u;return r=sn,(t=Un())!==n?((e=ts())===n&&(e=null),e!==n?((s=es())===n&&(s=null),s!==n?((u=ns())===n&&(u=null),u!==n?(r,r=t={func:e,args:[t],as:u}):(sn=r,r=n)):(sn=r,r=n)):(sn=r,r=n)):(sn=r,r=n),r===n&&(r=sn,(t=fs())!==n&&(e=ds())!==n&&(s=rs())!==n&&(u=vs())!==n?r=t=[t,e,s,u]:(sn=r,r=n)),r}function ts(){var t,e,s,u,o;if(t=sn,ms()!==n)if(r.substr(sn,4)===Rt?(e=Rt,sn+=4):(e=n,0===cn&&dn(qt)),e!==n)if(ms()!==n){if(s=sn,u=[],rt.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(tt)),o!==n)for(;o!==n;)u.push(o),rt.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(tt));else u=n;(s=u!==n?r.substring(s,sn):u)!==n?(t,t=s.toLowerCase()):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;else sn=t,t=n;return t}function es(){var t,e,s,u,o,a,c;return t=sn,(e=ms())!==n?(r.substr(sn,4)===It?(s=It,sn+=4):(s=n,0===cn&&dn(Nt)),s!==n&&(u=ms())!==n&&(o=Un())!==n&&(a=ts())!==n?((c=es())===n&&(c=null),c!==n?t=e=[e,s,u,o,a,c]:(sn=t,t=n)):(sn=t,t=n)):(sn=t,t=n),t}function ns(){var t,e,s;return t=sn,ms()!==n?("as"===r.substr(sn,2)?(e="as",sn+=2):(e=n,0===cn&&dn(Dt)),e!==n&&ms()!==n&&(s=fs())!==n?(t,t=s):(sn=t,t=n)):(sn=t,t=n),t}function ss(){var t,e;return t=sn,e=function(){var t,e,s,u,o,a,c,i,f,l,h;t=sn,e=sn,r.substr(sn,6)===Ut?(s=Ut,sn+=6):(s=n,0===cn&&dn(Mt));if(s!==n)if((u=ds())!==n)if((o=gs())!==n)if(r.substr(sn,4)===Pt?(a=Pt,sn+=4):(a=n,0===cn&&dn(Gt)),a===n&&(a=Un()),a!==n){if(c=[],i=sn,(f=gs())!==n&&(l=As())!==n&&(h=Un())!==n?i=f=[f,l,h]:(sn=i,i=n),i!==n)for(;i!==n;)c.push(i),i=sn,(f=gs())!==n&&(l=As())!==n&&(h=Un())!==n?i=f=[f,l,h]:(sn=i,i=n);else c=n;c!==n&&(i=gs())!==n&&(f=vs())!==n?e=s=[s,u,o,a,c,i,f]:(sn=e,e=n)}else sn=e,e=n;else sn=e,e=n;else sn=e,e=n;else sn=e,e=n;e!==n&&(t,e=function(r){const t=new Error("Rollup in groupby is not supported yet.");throw t.statusCode=501,t}());return t=e,t}(),e===n&&(e=Un()),e!==n&&t,t=e}function us(){var r,t,e;return r=sn,(t=kn())!==n&&(e=ns())!==n?r=t=[t,e]:(sn=r,r=n),r}function os(){var t,e;return cn++,t=sn,r.substr(sn,4)===Wt?(e=Wt,sn+=4):(e=n,0===cn&&dn(Xt)),e===n&&(r.substr(sn,5)===Yt?(e=Yt,sn+=5):(e=n,0===cn&&dn(re))),e!==n&&(t,e="true"===e),cn--,(t=e)===n&&(e=n,0===cn&&dn(Vt)),t}function as(){var t,e,s,u,o;if(cn++,t=sn,39===r.charCodeAt(sn)?(e=ee,sn++):(e=n,0===cn&&dn(ne)),e!==n){for(s=sn,u=[],r.substr(sn,2)===se?(o=se,sn+=2):(o=n,0===cn&&dn(ue)),o===n&&(oe.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(ae)));o!==n;)u.push(o),r.substr(sn,2)===se?(o=se,sn+=2):(o=n,0===cn&&dn(ue)),o===n&&(oe.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(ae)));(s=u!==n?r.substring(s,sn):u)!==n?(39===r.charCodeAt(sn)?(u=ee,sn++):(u=n,0===cn&&dn(ne)),u!==n?(t,t=e=s.replace(/''/g,"'")):(sn=t,t=n)):(sn=t,t=n)}else sn=t,t=n;return cn--,t===n&&(e=n,0===cn&&dn(te)),t}function cs(){var t,e,s,u,o,a,c,i,f,l,h,p,A,d,v,g,m,b,y,C,w,$,x,E,L;if(cn++,t=sn,e=sn,s=sn,u=[],be.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(ye)),o!==n)for(;o!==n;)u.push(o),be.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(ye));else u=n;if(u!==n)if(45===r.charCodeAt(sn)?(o=Ce,sn++):(o=n,0===cn&&dn(we)),o!==n)if(be.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(ye)),a!==n)if(be.test(r.charAt(sn))?(c=r.charAt(sn),sn++):(c=n,0===cn&&dn(ye)),c!==n)if(45===r.charCodeAt(sn)?(i=Ce,sn++):(i=n,0===cn&&dn(we)),i!==n)if(be.test(r.charAt(sn))?(f=r.charAt(sn),sn++):(f=n,0===cn&&dn(ye)),f!==n)if(be.test(r.charAt(sn))?(l=r.charAt(sn),sn++):(l=n,0===cn&&dn(ye)),l!==n){if(h=sn,84===r.charCodeAt(sn)?(p="T",sn++):(p=n,0===cn&&dn($e)),p!==n)if(be.test(r.charAt(sn))?(A=r.charAt(sn),sn++):(A=n,0===cn&&dn(ye)),A!==n)if(be.test(r.charAt(sn))?(d=r.charAt(sn),sn++):(d=n,0===cn&&dn(ye)),d!==n)if(58===r.charCodeAt(sn)?(v=sr,sn++):(v=n,0===cn&&dn(ur)),v!==n)if(be.test(r.charAt(sn))?(g=r.charAt(sn),sn++):(g=n,0===cn&&dn(ye)),g!==n)if(be.test(r.charAt(sn))?(m=r.charAt(sn),sn++):(m=n,0===cn&&dn(ye)),m!==n){if(b=sn,58===r.charCodeAt(sn)?(y=sr,sn++):(y=n,0===cn&&dn(ur)),y!==n)if(be.test(r.charAt(sn))?(C=r.charAt(sn),sn++):(C=n,0===cn&&dn(ye)),C!==n)if(be.test(r.charAt(sn))?(w=r.charAt(sn),sn++):(w=n,0===cn&&dn(ye)),w!==n){if($=sn,46===r.charCodeAt(sn)?(x=".",sn++):(x=n,0===cn&&dn(xe)),x!==n){if(E=[],be.test(r.charAt(sn))?(L=r.charAt(sn),sn++):(L=n,0===cn&&dn(ye)),L!==n)for(;L!==n;)E.push(L),be.test(r.charAt(sn))?(L=r.charAt(sn),sn++):(L=n,0===cn&&dn(ye));else E=n;E!==n?$=x=[x,E]:(sn=$,$=n)}else sn=$,$=n;$===n&&($=null),$!==n?b=y=[y,C,w,$]:(sn=b,b=n)}else sn=b,b=n;else sn=b,b=n;else sn=b,b=n;b===n&&(b=null),b!==n?(90===r.charCodeAt(sn)?(y="Z",sn++):(y=n,0===cn&&dn(Ee)),y===n&&(y=sn,43===r.charCodeAt(sn)?(C="+",sn++):(C=n,0===cn&&dn(Le)),C===n&&(45===r.charCodeAt(sn)?(C=Ce,sn++):(C=n,0===cn&&dn(we))),C!==n?(be.test(r.charAt(sn))?(w=r.charAt(sn),sn++):(w=n,0===cn&&dn(ye)),w!==n?(be.test(r.charAt(sn))?($=r.charAt(sn),sn++):($=n,0===cn&&dn(ye)),$!==n?(58===r.charCodeAt(sn)?(x=sr,sn++):(x=n,0===cn&&dn(ur)),x!==n?(be.test(r.charAt(sn))?(E=r.charAt(sn),sn++):(E=n,0===cn&&dn(ye)),E!==n?(be.test(r.charAt(sn))?(L=r.charAt(sn),sn++):(L=n,0===cn&&dn(ye)),L!==n?y=C=[C,w,$,x,E,L]:(sn=y,y=n)):(sn=y,y=n)):(sn=y,y=n)):(sn=y,y=n)):(sn=y,y=n)):(sn=y,y=n)),y===n&&(y=null),y!==n?h=p=[p,A,d,v,g,m,b,y]:(sn=h,h=n)):(sn=h,h=n)}else sn=h,h=n;else sn=h,h=n;else sn=h,h=n;else sn=h,h=n;else sn=h,h=n;else sn=h,h=n;h===n&&(h=null),h!==n?s=u=[u,o,a,c,i,f,l,h]:(sn=s,s=n)}else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;else sn=s,s=n;return(e=s!==n?r.substring(e,sn):s)!==n&&(t,e=function(r){if(r.split("-")[0].length>4)throw Object.assign(new Error(`The type 'Edm.DateTimeOffset' is not compatible with '${r}'`),{statusCode:400});return r}(e)),cn--,(t=e)===n&&(e=n,0===cn&&dn(me)),t}function is(){var t,e,s,u,o,a;if(cn++,t=sn,e=sn,s=sn,Se.test(r.charAt(sn))?(u=r.charAt(sn),sn++):(u=n,0===cn&&dn(Te)),u===n&&(u=null),u!==n){if(o=[],be.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(ye)),a!==n)for(;a!==n;)o.push(a),be.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(ye));else o=n;o!==n?s=u=[u,o]:(sn=s,s=n)}else sn=s,s=n;return(e=s!==n?r.substring(e,sn):s)!==n&&(t,e=parseInt(e)),cn--,(t=e)===n&&(e=n,0===cn&&dn(ke)),t}function fs(){var t,e,s,u,o,a,c,i;if(cn++,t=sn,e=sn,cn++,s=os(),cn--,s===n?e=void 0:(sn=e,e=n),e!==n)if(s=sn,cn++,u=ls(),cn--,u===n?s=void 0:(sn=s,s=n),s!==n){if(u=sn,o=sn,Ze.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(ze)),a!==n){for(c=[],_e.test(r.charAt(sn))?(i=r.charAt(sn),sn++):(i=n,0===cn&&dn(Fe));i!==n;)c.push(i),_e.test(r.charAt(sn))?(i=r.charAt(sn),sn++):(i=n,0===cn&&dn(Fe));c!==n?o=a=[a,c]:(sn=o,o=n)}else sn=o,o=n;(u=o!==n?r.substring(u,sn):o)!==n?(t,t=e=u):(sn=t,t=n)}else sn=t,t=n;else sn=t,t=n;return cn--,t===n&&(e=n,0===cn&&dn(Oe)),t}function ls(){var t,e,s,u,o,a,c,i,f,l,h,p,A,d;return cn++,t=sn,e=sn,(s=hs())!==n&&(u=hs())!==n?(45===r.charCodeAt(sn)?(o=Ce,sn++):(o=n,0===cn&&dn(we)),o===n&&(o=null),o!==n&&(a=hs())!==n?(45===r.charCodeAt(sn)?(c=Ce,sn++):(c=n,0===cn&&dn(we)),c===n&&(c=null),c!==n&&(i=hs())!==n?(45===r.charCodeAt(sn)?(f=Ce,sn++):(f=n,0===cn&&dn(we)),f===n&&(f=null),f!==n&&(l=hs())!==n?(45===r.charCodeAt(sn)?(h=Ce,sn++):(h=n,0===cn&&dn(we)),h===n&&(h=null),h!==n&&(p=hs())!==n&&(A=hs())!==n&&(d=hs())!==n?e=s=[s,u,o,a,c,i,f,l,h,p,A,d]:(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n),t=e!==n?r.substring(t,sn):e,cn--,t===n&&(e=n,0===cn&&dn(Re)),t}function hs(){var t,e,s,u,o,a;return cn++,t=sn,e=sn,Ie.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(Ne)),s!==n?(Ie.test(r.charAt(sn))?(u=r.charAt(sn),sn++):(u=n,0===cn&&dn(Ne)),u!==n?(Ie.test(r.charAt(sn))?(o=r.charAt(sn),sn++):(o=n,0===cn&&dn(Ne)),o!==n?(Ie.test(r.charAt(sn))?(a=r.charAt(sn),sn++):(a=n,0===cn&&dn(Ne)),a!==n?e=s=[s,u,o,a]:(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n)):(sn=e,e=n),t=e!==n?r.substring(t,sn):e,cn--,t===n&&(e=n,0===cn&&dn(qe)),t}function ps(){var t,e,s,u;if(t=sn,e=sn,s=[],De.test(r.charAt(sn))?(u=r.charAt(sn),sn++):(u=n,0===cn&&dn(Ue)),u!==n)for(;u!==n;)s.push(u),De.test(r.charAt(sn))?(u=r.charAt(sn),sn++):(u=n,0===cn&&dn(Ue));else s=n;return(e=s!==n?r.substring(e,sn):s)!==n&&(t,e={val:e}),t=e}function As(){var t,e,s,u;return t=sn,(e=gs())!==n?(44===r.charCodeAt(sn)?(s=",",sn++):(s=n,0===cn&&dn(Wr)),s!==n&&(u=gs())!==n?t=e=[e,s,u]:(sn=t,t=n)):(sn=t,t=n),t}function ds(){var t,e,s,u;return t=sn,(e=gs())!==n?(40===r.charCodeAt(sn)?(s="(",sn++):(s=n,0===cn&&dn(Xe)),s!==n&&(u=gs())!==n?t=e=[e,s,u]:(sn=t,t=n)):(sn=t,t=n),t}function vs(){var t,e,s;return t=sn,(e=gs())!==n?(41===r.charCodeAt(sn)?(s=")",sn++):(s=n,0===cn&&dn(Ye)),s!==n?t=e=[e,s]:(sn=t,t=n)):(sn=t,t=n),t}function gs(){var t,e,s;for(cn++,t=sn,e=[],tn.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(en));s!==n;)e.push(s),tn.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(en));return t=e!==n?r.substring(t,sn):e,cn--,t===n&&(e=n,0===cn&&dn(rn)),t}function ms(){var t,e,s;if(cn++,t=sn,e=[],tn.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(en)),s!==n)for(;s!==n;)e.push(s),tn.test(r.charAt(sn))?(s=r.charAt(sn),sn++):(s=n,0===cn&&dn(en));else e=n;return t=e!==n?r.substring(t,sn):e,cn--,t===n&&(e=n,0===cn&&dn(nn)),t}const bs=Object.assign,{strict:ys,minimal:Cs}=t,ws=[];let $s,xs;const Es=["$value"],Ls=t.safeNumber||function(r){const t=Number(r);return Number.isSafeInteger(t)?t:r},Bs=t.skipToken,Ss=t.standardBase64||function(r){return Buffer.from(r,"base64").toString("base64")},Ts=r=>t=>r===t||r.as&&t.as&&r.as===t.as||t.as&&r.ref&&t.as===r.ref[r.ref.length-1]||r.ref&&t.ref&&r.ref.join("")===t.ref.join(""),js=r=>t=>{if(Array.isArray(t))return t.map(js(r));const e=t.ref&&r.find((r=>r.as&&r.func&&r.as===t.ref[0]));return e||t},ks=r=>t=>Array.isArray(t)?t.map(ks(r)):t.ref&&!r.find(Ts(t))?{val:null}:t,Os=(r,t)=>{if(1===t.ref.length)r.find(Ts(t))||r.push(t);else{const e=t.ref.shift(),n=r.find((r=>r.ref&&r.ref[0]===e));if(n)Os(n.expand,t);else{const n={ref:[e],expand:[]};Os(n.expand,t),r.push(n)}}},Zs=(r,t,e=!1)=>{let n=Fs({from:r.from},t,e);if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=zs(n[t],r,e);else n=zs(n,r,e);return n},zs=(r,t,e)=>{if(!t)return r;t.apply&&delete t.apply;let n={};t.columns&&"$count"===t.columns[0].as||r.SELECT.where&&t.where||r.SELECT.limit&&t.limit||r.SELECT.orderBy&&t.orderBy||r.SELECT.search&&t.search?n.from=r:n=r.SELECT;for(const r in t)"columns"===r?(t.columns=t.columns.map((r=>n.columns&&n.columns.find((t=>r.ref&&r.ref[0]===t.as||t.ref&&r.ref&&r.ref[0]===t.ref[0]&&!r.expand))||r)),n.columns&&n.groupBy&&t.columns.push(...n.columns.filter((r=>e&&n.groupBy.find((t=>r.ref&&r.ref[0]===t.ref[0]))&&!t.columns.some((t=>t.ref&&t.ref[0]===r.as||t.ref&&r.ref&&t.ref[0]===r.ref[0]||t.as&&t.as===r.as))))||[]),n.columns=t.columns):"from"!==r&&(n[r]=t[r]);const s=[...n.columns&&n.columns.filter((r=>n.groupBy&&n.groupBy.find((t=>r.ref&&r.ref[0]===t.ref[0]))))||[],...n.columns&&n.columns.filter((r=>r&&"object"==typeof r&&"func"in r))||[]];return _s(n,s,e),{SELECT:n}},_s=(r,t,e)=>{t.length&&(r.columns=r.columns&&!e?r.columns.reduce(((r,e)=>{const n=t.find(Ts(e));return n&&r.push(n),r}),[]):t,r.where&&(r.where=r.where.map(js(r.columns)),r.groupBy&&(r.having=r.where.map(ks(r.groupBy)),delete r.where)),r.columns=r.columns.reduce(((r,e)=>(e.ref&&e.ref.length>1&&t.find(Ts(e))?Os(r,{ref:[...e.ref]}):r.push(e),r)),[]))},Fs=(r,t,e)=>{if(!t)return;if(r.apply&&delete r.apply,t.identity&&r.from.SELECT&&(r=r.from.SELECT),(t.apply||t.where&&r.where||t.search&&r.search||t.limit&&r.limit||t.orderBy&&r.orderBy)&&(r.from={SELECT:{...r}}),t.where&&(r.where=t.where),t.search&&(r.search=t.search),t.groupBy){r.groupBy=[];for(const e of t.groupBy)r.groupBy.find(Ts(e))||r.groupBy.push(e)}t.limit&&(r.limit=t.limit),t.orderBy&&(r.orderBy=t.orderBy);const n=[...r.groupBy||[],...t.aggregate||[]];if(_s(r,n,e),t.apply&&r.from&&Fs(r.from.SELECT,t.apply),t.concat&&Array.isArray(t.concat)){const e=[];for(let n of t.concat){n.from=1===Object.keys(r).length?r.from:{SELECT:r};const t=Fs(n,n.apply);Array.isArray(t)?e.push(...t):e.push(t)}r=e}return Array.isArray(r)?r:{SELECT:r}},Rs=r=>{$s.limit&&$s.limit.offset&&$s.limit.offset.val&&(r+=$s.limit.offset.val),($s.limit||($s.limit={})).offset={val:r}},qs=(r,t=!1)=>{$s.orderBy=$s.orderBy?t?[r,...$s.orderBy]:[...$s.orderBy,r]:[r]},Is=(r,t)=>{for(const e of t)e.ref&&e.ref[0]===r&&e.ref.shift(),e.func&&Is(r,e.args);return t},Ns=(r,t,e,n=!1)=>{r?.forEach((r=>{r.val===t?r.val=e.val:r.list===t?r.list=e.list:r.func?r.args.forEach(((r,s)=>{r.val===t?r.val=e.val:r.func&&Ns(r.args,t,e,n)})):r.SELECT&&Ds(r.SELECT,t,e,n)}))},Ds=(r,t,e,n=!1)=>{const{where:s,from:u}=r;Ns(s,t,e),u?.ref?.forEach((r=>{Ns(r.where,t,e,!0)}))};if((e=u())!==n&&sn===r.length)return e;throw e!==n&&sn<r.length&&dn({type:"end"}),vn(an,on<r.length?r.charAt(on):null,on<r.length?An(on,on+1):An(on,on))}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(r,t){var e={literal:function(r){return'"'+s(r.text)+'"'},class:function(r){var t,e="";for(t=0;t<r.parts.length;t++)e+=r.parts[t]instanceof Array?u(r.parts[t][0])+"-"+u(r.parts[t][1]):u(r.parts[t]);return"["+(r.inverted?"^":"")+e+"]"},any:function(r){return"any character"},end:function(r){return"end of input"},other:function(r){return r.description}};function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function s(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}function u(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}return"Expected "+function(r){var t,n,s,u=new Array(r.length);for(t=0;t<r.length;t++)u[t]=(s=r[t],e[s.type](s));if(u.sort(),u.length>0){for(t=1,n=1;t<u.length;t++)u[t-1]!==u[t]&&(u[n]=u[t],n++);u.length=n}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}(r)+" but "+function(r){return r?'"'+s(r)+'"':"end of input"}(t)+" found."},module.exports={SyntaxError:peg$SyntaxError,parse:peg$parse};
